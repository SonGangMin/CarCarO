<%- include('../include/managerhead.ejs') %>
<link rel="stylesheet" href="/stylesheets/car.css">
<div class="container">
    <div class="contents">
        <h1>차량관리</h1>
        <h2 class="title">판매목록</h2>  
        <h3 class="counting">총 <span><%= totalCount %></span>개</h3>
          <!-- <form action="/car/hashtag">
              <input type="text" name="hashtag">
              <button class="btn">검색</button>
          </form> -->
        <ul class="viewImg">
          <% Cars.forEach(function(carList) { %>
          <li onclick="location.href='/manager/managerCar/detail/<%= carList.carNum %>'"  <% if (carList.recommends === 1) { %>class="recommended"<% } %>>
              <% if (carList.picture.length > 0) { %>
              <img src="<%= carList.picture[0].url %>" alt="" class="thumbnail">
              <% } %>
              <div class="middle_li">
                <p><%= carList.brand %> <%= carList.model %></p>
                <div class="option">
                  <span><%= carList.year %></span>
                  <span><%= carList.mile %>km</span>
                  <span><%= carList.fuel %></span>
                  <span><%= carList.hashtag %></span>
                </div>
              </div>
              <div class="buttonBox">
                <a href="/car/caredit/<%= carList.carNum %>">수정</a>
                <form action="/car/delete/<%= carList.carNum %>" method="POST">
                  <input type="submit" value="삭제" />
                </form>
                <form action="/manager/managerCar/recommend/<%= carList.carNum %>" method="post">
                  <% if(carList.recommends === 0) { %>
                  <button>추천차량등록</button>
                  <% } else if(carList.recommends === 1) { %>
                  <button>추천차량취소</button>
                  <% } %>
                </form>  
              </div>
          </li>
          <% }); %>
        </ul>
        
        <% if (totalPages > 1) { %>
            <nav>
              <ul class="pagination">
                <% if (currentPage == 1) { %>
                  <li class="disabled"><span>&laquo;</span></li>
                <% } else { %>
                  <li><a href="?page=<%= currentPage - 1 %>">&laquo;</a></li>
                <% } %>
          
                <% for (let i = 1; i <= totalPages; i++) { %>
                  <% if (i == currentPage) { %>
                    <li class="active"><span><%= i %></span></li>
                  <% } else { %>
                    <li><a href="?page=<%= i %>"><%= i %></a></li>
                  <% } %>
                <% } %>
          
                <% if (currentPage == totalPages) { %>
                  <li class="disabled"><span>&raquo;</span></li>
                <% } else { %>
                  <li><a href="?page=<%= currentPage + 1 %>">&raquo;</a></li>
                <% } %>
              </ul>
            </nav>
          <% } %>
    </div>
</div>
</body>
<script>
  const arrayForm = document.getElementById('arrayForm');
  const array = document.getElementById('array');
  array.addEventListener('change', () => {
    arrayForm.submit();
  });

  if (window.location.search.includes('array=%EB%93%B1%EB%A1%9D%EC%88%9C')) {
    // query 값에 "array=등록순"이 포함되어 있을 경우
    document.querySelector('#array option[value="등록순"]').selected = true;
  } else {
    // 그 외의 경우 (최신순이 기본값이므로)
    document.querySelector('#array option[value="최신순"]').selected = true;
  }
  console.log(window.location.search); // 현재 페이지의 query string 출력
  console.log(document.querySelector('#array option[selected]').value); 
</script>
</html>