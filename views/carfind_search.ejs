<%- include('./include/head.ejs') %>
<style>
  /* .searchbox {
    border: solid 1px black;
    padding: 30px;
  } */
  .select1 {
    margin: 0;
    padding: 20px;
    align-items: center;
    size: 150px;
  }
  .search {
    margin: 0;
    padding-top: 18px;
    padding-bottom: 40px;
    align-items: center;
  }

  .thumbnail {
    width: 100%;
    height: 150px;
  }
  .listbox {
    border: 1px solid black;
    /* background-color: red; */
    width: 100%;
    /* margin: 0 5%; */
  }
  li {
    display: inline-block;
  }
  .bigbox {
      border: solid 1px black;
      padding: 100px;
      position: relative;
      width: 100%;
      display: block;
      /* left: 15%; */
    }

    .statistics {
      text-align: right;
      width: 100%;
    }
    .searchbox {
      width: 100%;
    }
    .bigbox ul {
      display: flex;
      flex-wrap: wrap;
    }
    .bigbox ul li {
      width: 25%;
      padding: 10px 10px;
      text-align: center;
    }
    h1 {
      text-align: center;
    }
    
    .text-box{
      margin-bottom: 10px;
      margin-top: -20px;
    }


    .hash {
      width: 25%;
      display: flex;
      display: inline;
      margin: 5%;
    }

    .like {
      position: relative;
      right: -35%;
      top: -40px;
      /* border: solid 1px black; */
    }

    #highlight {
      background-color: lightcoral;
    }
    .check {
      border: 1px solid black;
      box-sizing: border-box;
    }
    .condition {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    align-items: center;
    margin-top: 20px;
    }

    .condition > div {
      margin: 5px;
      padding: 5px 10px;
      border-radius: 20px;
      background-color: #87ceeb;
      font-size: 14px;
      color: #fff;
    }
    .unit {
      position: absolute;
      right: 0;
    }

</style>
<div class="findcar">
  <div class="bigbox" id="search">
    <div class="statistics">
      전체: &nbsp;&nbsp;&nbsp;&nbsp; <%= total %>대<br />최근등록(24시간):
      &nbsp;&nbsp;&nbsp;&nbsp; <%= recenttotal %>대
    </div>
    국산●수입차
    <form action="/car/carfind/search/" method="get">
      <div class="searchbox">
        <select class="select1" name="from" id="from">
          <option value="" selected>국산or수입</option>
          <option value="국산">국산</option>
          <option value="수입">수입</option>

        </select>
        <select class="select1" name="brand" id="brand">
          <option value="" selected>국산·수입 선택하세요</option>
        </select>

        <input type="text" name="model" class="select1" placeholder="모델명">
      </div>
      <div class="price-input">
        차량 가격 
        <select name="lowprice">
          <option value="0" selected>0 만원</option>
          <option value="100">100 만원</option>
          <option value="200">200 만원</option>
          <option value="300">300 만원</option>
          <option value="400">400 만원</option>
          <option value="500">500 만원</option>
          <option value="600">600 만원</option>
          <option value="700">700 만원</option>
          <option value="800">800 만원</option>
          <option value="900">900 만원</option>
          <option value="1000">1000 만원</option>
          <option value="2000">2000 만원</option>
          <option value="3000">3000 만원</option>
          <option value="4000">4000 만원</option>
          <option value="5000">5000 만원</option>
          <option value="6000">6000 만원</option>
        </select>
        ~
        <select name="highprice">
          <option value="50000">5 억원</option>
          <option value="20000">2 억원</option>
          <option value="10000">1 억원</option>
          <option value="8000">8000 만원</option>
          <option value="6000">6000 만원</option>
          <option value="5000">5000 만원</option>
          <option value="4000">4000 만원</option>
          <option value="3000">3000 만원</option>
          <option value="2000">2000 만원</option>
          <option value="1000">1000 만원</option>
          <option value="900">900 만원</option>
          <option value="800">800 만원</option>
          <option value="700">700 만원</option>
          <option value="600">600 만원</option>
          <option value="500">500 만원</option>
          <option value="400">400 만원</option>
          <option value="300">300 만원</option>
          <option value="200">200 만원</option>
          <option value="100">100 만원</option>
          <option value="0">0 만원</option>
        </select>
      </div>
      변속기
        <select name="trans" id="trans">
          <option value='' selected>전체</option>
          <option value="수동">수동</option>
          <option value="자동">자동</option></select
        >
        사용 연료
        <select name="fuel">
          <option value="" selected>전체</option>
          <option value="휘발유">휘발유</option>
          <option value="경유">경유</option>
          <option value="전기">전기</option>
          <option value="수소">수소</option>
          <option value="하이브리드">하이브리드</option>
          <option value="기타">기타</option>
        </select><br>
        차량 연식
        <select name="startyear">
          <option value="0" selected>2000년 이전</option>
          <option value="2001">2001년</option>
          <option value="2002">2002년</option>
          <option value="2003">2003년</option>
          <option value="2004">2004년</option>
          <option value="2005">2005년</option>
          <option value="2006">2006년</option>
          <option value="2007">2007년</option>
          <option value="2008">2008년</option>
          <option value="2009">2009년</option>
          <option value="2010">2010년</option>
          <option value="2011">2011년</option>
          <option value="2012">2012년</option>
          <option value="2013">2013년</option>
          <option value="2014">2014년</option>
          <option value="2015">2015년</option>
          <option value="2016">2016년</option>
          <option value="2017">2017년</option>
          <option value="2018">2018년</option>
          <option value="2019">2019년</option>
          <option value="2020">2020년</option>
          <option value="2021">2021년</option>
          <option value="2022">2022년</option>
          <option value="2023">2023년</option>
        </select>
        부터
        <select name="endyear">
          <option value="2001">2001년</option>
          <option value="2002">2002년</option>
          <option value="2003">2003년</option>
          <option value="2004">2004년</option>
          <option value="2005">2005년</option>
          <option value="2006">2006년</option>
          <option value="2007">2007년</option>
          <option value="2008">2008년</option>
          <option value="2009">2009년</option>
          <option value="2010">2010년</option>
          <option value="2011">2011년</option>
          <option value="2012">2012년</option>
          <option value="2013">2013년</option>
          <option value="2014">2014년</option>
          <option value="2015">2015년</option>
          <option value="2016">2016년</option>
          <option value="2017">2017년</option>
          <option value="2018">2018년</option>
          <option value="2019">2019년</option>
          <option value="2020">2020년</option>
          <option value="2021">2021년</option>
          <option value="2022">2022년</option>
          <option value="2023" selected>2023년</option>
        </select>
        까지 &nbsp;&nbsp;&nbsp;&nbsp; 

        주행거리
        <select name="shortmile">
          <option value="0" selected>0 km</option>
          <option value="100" >100 km</option>
          <option value="500" >500 km</option>
          <option value="1000" >1,000 km</option>
          <option value="5000" >5,000 km</option>
          <option value="10000" >10,000km</option>
          <option value="20000" >20,000 km</option>
          <option value="50000" >50,000 km</option>
          <option value="100000" >100,000 km</option>
          <option value="200000" >200,000 km</option>
          <option value="500000" >500,000 km</option>
        </select>
        ~
        <select name="longmile">
          <option value="500000" selected>500,000 km</option>
          <option value="200000" >200,000 km</option>
          <option value="100000" >100,000 km</option>
          <option value="50000" >50,000 km</option>
          <option value="20000" >20,000 km</option>
          <option value="10000" >10,000km</option>
          <option value="5000" >5,000 km</option>
          <option value="1000" >1,000 km</option>
          <option value="500" >500 km</option>
          <option value="100" >100 km</option>
          <option value="0" >0 km</option>
        </select>
<br>
        <button type="submit" class="search">검색</button><br />
      </div>

    </form>
  </div>
  <div><h1>선택한 검색조건</h1></div>
  <div class="condition">
    <% if (from) { %>
      <div><%= from %></div>
    <% } %>
    <% if (brand) { %>
      <div><%= brand %></div>
    <% } %>
    <% if (model) { %>
      <div>모델명: <%= model %></div>
    <% } %>

    <div><%= lowprice %> 만원 ~
    <%= highprice %> 만원 까지</div>

    <% if (trans) { %>
      <div><%= trans %></div>
    <% } %>

      <div><%= startyear %> 년식 ~
      <%= endyear %> 년식 까지</div>

    <% if (fuel) { %>
      <div><%= fuel %></div>
    <% } %>

      <div><%= shortmile %> km ~
      <%= longmile %> km 까지</div>

  </div>
  

  <div class="bigbox" id="list">
    <h1>검색 결과 총 <%= total %> 건</h1>
    <br />
    <ul>
      <% Cars.forEach(function(car) { %>
      <li>
        <!-- <% console.log('car.price ===>', car.price) %> -->
        <a href="/car/detail/<%= car.carNum %>">
          <div
            class="listbox"
            id="<%= isMine === car.user_id ? 'highlight' : '' %>"
          >
          <!-- <div class="check"> -->
            <% if (car.picture.length > 0) { %>
              <img src="<%= car.picture[0].url %>" alt="" class="thumbnail">
              <% } %>
            <div class="like">
              <% let count=0; %>
              <% for(let i=0; i < car.likes.length; i++) { %>
                <% if(car.likes[i].user_id == isMine) { %>
                  <% count++; %>
                <% } %>
              <% } %>
              <% console.log(isMine) %>
              <% console.log(isMine === car.user_id) %>
              <% if (typeof isMine === 'undefined') { %>
                <button class="notLoggedIn">♥ 로그인안함<%= car.likes_count %></button>
              <% } else if (isMine === car.user_id) { %>
                <button class="Mine">♥ 내차<%= car.likes_count %></button>
              <% } else { %>
                <% if(!count) { %>
                  <form action="/car/carfind" method="post" onsubmit="return confirm('관심차량 목록에 추가하시겠습니까?')">
                    <input type="hidden" name="carNum" value="<%= car.num %>">
                    <button type="submit" class="heart">♥ <%= car.likes_count %></button>
                  </form>
                <% } else { %>
                  <form action="/car/carfind2" method="post" onsubmit="return confirm('관심차량 목록에서 삭제하시겠습니까?')">
                    <input type="hidden" name="carNum" value="<%= car.num %>">
                    <button type="submit" class="heart">♡ <%= car.likes_count %></button>
                  </form>
                <% } %>
              <% } %>
            </div>
            <div class="text-box">
              <div> <%= car.from %> <%= car.brand %> <%= car.model %> </div>
      
              <div><%= car.fuel %> <%= car.year %>년식 <%= car.price %>만원</div>
              <% for(i=0; i<car.hashtags.length; i++) { %>
                <div class="hash">#<%= car.hashtags[i].cars_hashtag %></div>
              <% } %>
            </div>
           
          </div>
        </a>
      </li>
      <% }) %>
    </ul>
  </div>
</div>

<script>
function onPageClick(event, page) {
  const queryParams = new URLSearchParams(window.location.search);
  queryParams.set('page', page); // 현재 페이지 설정

  const queryString = queryParams.toString();
  const searchUrl = `/car/carfind/search/?${queryString}`;

  location.href = searchUrl;
}
</script>
<%- include('./include/pagination.ejs') %>

<script>
  const fromSelect = document.querySelector('#from');
  const brandSelect = document.querySelector('#brand');

  fromSelect.addEventListener('change', () => {
    if (fromSelect.value === "국산") {
    brandSelect.innerHTML = `
        <option value="">국산 전체</option>
        <option value="현대">현대</option>
        <option value="제네시스">제네시스</option>
        <option value="기아">기아</option>
        <option value="쉐보레">쉐보레(GM대우)</option>
        <option value="쌍용">쌍용</option>
        <option value="국산기타">기타</option>
        
    `;
  } else if (fromSelect.value === "수입") {
    brandSelect.innerHTML = `
    <option value="">수입 전체</option>
    <option value="벤츠">벤츠</option>
    <option value="아우디">아우디</option>
    <option value="BMW">BMW</option>
    <option value="볼보">볼보</option>
    <option value="폭스바겐">폭스바겐</option>
    <option value="포르쉐">포르쉐</option>
    <option value="수입기타">기타</option>
    `;
  } else {
    brandSelect.innerHTML = `
      <option value="" selected>국산·수입 선택하세요</option>
    `;
  }
  });
  // const transSelect = document.getElementById("trans");
  // transSelect.addEventListener("change", function() {
  //   if (transSelect.value === "") {
  //     // 전체를 선택한 경우, 다른 모든 옵션을 선택한 것과 같게 처리
  //     transSelect.selectedIndex = 0;
  //   }
  // });

//   const lowPrice = document.querySelector('#lowprice').value;
// const highPrice = document.querySelector('#highprice').value;
// const shortMile = document.querySelector('#shortmile').value;
// const longMile = document.querySelector('#longmile').value;
</script>