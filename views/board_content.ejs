<%- include('./include/head.ejs') %>
<style>
  .comment {
    display: flex;
  }
  .txt {
    display: block;
  }
  .input {
    display: none;
  }
</style>
<h1><%= board.title %></h1>
<p><%= board.content %></p>
<p>작성자: <%= board.user.name %></p>
<p>최초 작성일: <%= board.createdAt %></p>
<p>최종 수정일: <%= board.updatedAt %></p>

<div class="comment">
  <% if (isboardOwner) { %>
  <button><a href="/board/edit/<%= board.postId %>">수정</a></button>
  <form action="/board/delete/<%= board.postId %>" method="POST">
    <input type="submit" value="삭제" />
  </form>
  <% } %>
</div>
<br /><br /><br /><br /><br />

<h2>댓글~</h2>
<ul>
  <% comments.forEach(function(comment) { %>
  <li class="comment">
    작성자: <%= comment.user.name %>(<%= comment.user_id %>) 내용:
    <div class="txt"><%= comment.content %></div>
    <% if (comment.user_id === userId) { %>
    <form
      action="/manager/managerboard/comment/edit/<%= comment.number %>"
      method="post"
    >
      <div class="input" style="display: none">
        <input
          type="text"
          value="<%= comment.content %>"
          style="width: 350px"
          name="content"
        />
      </div>
      <input
        class="input"
        type="button"
        onclick="window.location.reload();"
        value="취소"
      />
      <input class="input" type="submit" value="적용" />
    </form>
    <button class="txt" id="edit">수정</button>

    <form action="/board/comment/delete/<%= comment.number %>" method="POST">
      <input type="submit" value="삭제" />
    </form>
  </li>
  <% } %><% }); %>
</ul>

<script>
  // document.querySelector(".edit").addEventListener("click", function (event) {
  //   event.preventDefault(); // 폼 전송 막기
  // });
  const edits = document.querySelectorAll("#edit");
  edits.forEach((target) => {
    target.addEventListener("click", function () {
      const test = this.parentNode.childNodes[3].childNodes;
      const test2 = this.parentNode.childNodes;
      const test3 = this.parentNode;
      const txtcomment = test2[1]; //완
      const inputcomment = test[1]; //완
      const inputsubmit = test[5]; //완
      const inputcancel = test[3];
      const txtedit = test2[5];
      const txtdelete = test2[7];
      console.log(test2);
      txtcomment.style.display = "none";
      inputcomment.style.display = "block";
      inputsubmit.style.display = "block";
      inputcancel.style.display = "block";
      txtedit.style.display = "none";
      txtdelete.style.display = "none";
    });
  });
</script>

<% if (isUser) { %>
<form action="/board/<%= board.postId %>" method="post">
  <input type="text" name="content" />
  <input type="submit" value="등록" />
</form>
<% } %>
<br />
<button><a href="/board">목록으로</a></button>
