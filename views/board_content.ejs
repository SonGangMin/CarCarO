<%- include('./include/head.ejs') %>
<link rel="stylesheet" href="/stylesheets/boardcontent.css" />
<div class="container">
  <div class="contents">
    <div class="titlearea">
      <div class="main_name" onclick="location.href='/board/'">커뮤니티</div>
    </div>
    <hr class="greenhr" />
    <div class="board_container2">
      <div class="board_title">
        <% if(board.grade === 1) { %> [일반] <% } else { %> [공지] <% } %> <%=
        board.title %>
      </div>
      <div class="board_name">
        <span
          ><%= board.user.name %>(<%= board.user_id %>) | 조회수 : <%=
          board.views %></span
        >
        <span
          ><%= board.createdAt.getFullYear() %>년 <%=
          (board.createdAt.getMonth() + 1) %>월 <%= board.createdAt.getDate()
          %>일 (<%= ["일", "월", "화", "수", "목", "금",
          "토"][board.createdAt.getDay()] %>) <%= board.createdAt.getHours()
          %>시 <%= board.createdAt.getMinutes() %>분</span
        >
      </div>
      <div class="board_content">
        <% board.content.split('\n').forEach(function(line) { %> <%= line %><br />
        <% }) %>
      </div>

      <div class="buttons">
        <% if (isboardOwner) { %>
        <button
          onclick="return confirm('게시글을 수정하시겠습니까?')"
          class="button"
        >
          <a href="/board/edit/<%= board.postId %>">수정</a>
        </button>
        <form
          action="/board/delete/<%= board.postId %>"
          method="POST"
          onsubmit="return confirm('게시글을 정말로 삭제하시겠습니까?')"
        >
          <input type="submit" value="삭제" class="button" />
        </form>
        <% } %>
      </div>
    </div>

    <div class="board_container2">
      <div class="comment_title">
        전체댓글 <span class="text_red"><%= board.count %></span>개
      </div>
      <hr class="greenhr2" />
      <ul>
        <% comments.forEach(function(comment) { %>
        <li class="comment">
          <div class="comment_user">
            <%= comment.user.name %>(<%= comment.user_id %>)
          </div>
          <div id="comment_content">
            <div class="txt" id="content_txt"><%= comment.content %></div>
            <% if (comment.user_id === userId) { %>
            <form
              id="edit-form-<%= comment.number %>"
              action="/board/comment/edit/<%= comment.number %>"
              method="post"
              class="comment_form"
            >
              <input
                class="input"
                id="comment_input"
                type="text"
                value="<%= comment.content %>"
                style="display: none; width: 350px"
                name="content"
              />
              <div class="cancelsubmit">
                <input
                  class="input cancel"
                  type="button"
                  onclick="window.location.reload();"
                  value="취소"
                  style="display: none"
                />
                <input
                  class="input submit"
                  type="submit"
                  value="적용"
                  style="display: none"
                />
              </div>
            </form>
            <span class="commenttime"
              ><%= (comment.createdAt.getMonth() + 1) %>월 <%=
              comment.createdAt.getDate() %>일 (<%= ["일", "월", "화", "수",
              "목", "금", "토"][comment.createdAt.getDay()] %>) <%=
              comment.createdAt.getHours() %>: <%=
              comment.createdAt.getMinutes() %></span
            >
            <button
              class="txt edit"
              id="editdelete"
              data-comment-number="<%= comment.number %>"
            >
              수정
            </button>
            <form
              action="/board/comment/delete/<%= comment.number %>"
              method="POST"
              onsubmit="return confirm('댓글을 정말로 삭제하시겠습니까?')"
            >
              <input
                class="delete"
                type="submit"
                value="삭제"
                id="editdelete"
              />
            </form>
          </div>
          <% } %>
        </li>
        <% }); %>
      </ul>
      <% if (isUser) { %>
      <div class="createcomment">
        <div class="createcomment_head">댓글등록하기</div>
        <form action="/board/content/<%= board.postId %>" method="post">
          <input type="text" name="content" class="createinput" />
          <div class="commentsubmit">
            <input type="submit" style="cursor: pointer" value="등록" />
          </div>
        </form>
      </div>
      <% } %>
      <script>
        const edits = document.querySelectorAll(".edit");
        edits.forEach((target) => {
          target.addEventListener("click", function () {
            const commentContent = this.parentNode.querySelector(".txt");
            const inputComment = this.parentNode.querySelector(".input");
            const inputSubmit = this.parentNode.querySelector(".submit");
            const inputCancel = this.parentNode.querySelector(".cancel");
            const txtEdit = this;
            const txtDelete = this.parentNode.querySelector(".delete");

            commentContent.style.display = "none";
            inputComment.style.display = "block";
            inputSubmit.style.display = "block";
            inputCancel.style.display = "block";
            txtEdit.style.display = "none";
            txtDelete.style.display = "none";
          });
        });

        const submitButtons = document.querySelectorAll(".submit");
        submitButtons.forEach((button) => {
          button.addEventListener("click", function (event) {
            const form = this.parentNode.querySelector("form");
            form.submit();
          });
        });
      </script>
      <script>
        function onPageClick(event, page) {
          location.href = "/board/content/<%= board.postId %>?page=" + page;
          console.info(page + " (from options)");
        }
      </script>
      <%- include('./include/pagination.ejs') %>
    </div>
    <hr class="greenhr" />
    <br />
    <button><a href="/board">목록으로</a></button>
  </div>
</div>
<%- include('./include/footer.ejs') %>
